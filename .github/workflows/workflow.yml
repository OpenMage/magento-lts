name: CI

on:
  push:
    paths:
      - '.github/**'
      - 'composer.json'
      - 'composer.lock'
      - '**.php'
      - '**.xml'

  pull_request_target:
    paths:
      - '.github/**'
      - 'composer.json'
      - 'composer.lock'
      - '**.php'
      - '**.xml'

jobs:
  composer:
    name: Composer
    uses: ./.github/workflows/composer.yml

  phpcs:
    name: PHPCS
    needs: [composer]
    uses: ./.github/workflows/phpcs.yml

  php-cs-fixer:
    name: PHP-CS-Fixer
    needs: [composer]
    uses: ./.github/workflows/php-cs-fixer.yml

  phpstan:
    name: PHPStan
    needs: [composer, phpcs, php-cs-fixer]
    uses: ./.github/workflows/phpstan.yml

  syntax_php:
    name: Syntax
    needs: [composer, phpcs, php-cs-fixer]
    uses: ./.github/workflows/syntax-php.yml

  syntax_xml:
    name: Syntax
    needs: [composer]
    uses: ./.github/workflows/syntax-xml.yml

  sonar:
    name: Sonar Unit Tests
    needs: [composer, phpcs, php-cs-fixer]
    uses: ./.github/workflows/sonar.yml

  unit_tests:
    name: OpenMage LTS - Unit Tests
    needs: [composer, sonar]
    uses: ./.github/workflows/phpunit.yml
